Attempting to activate Conda environment...
Conda environment successfully activated: gigapath (Path: /home/nsong/anaconda3/envs/gigapath/bin/python)
[INFO] PY_BIN=/home/nsong/anaconda3/envs/gigapath/bin/python
Date: Sun Dec  7 15:28:46 MST 2025
Job ID: 28085325
Job Name: discotme_demo
Node list: g-g-1-7-16
Number of nodes: 1
Partition: gpu-v100
CPUs per task: 16
Memory per node: 122880
Current working directory: /coh_labs/dits/nsong/manuscript/DiSCoTME/eval
Using VIS_SCRIPT: visualization_usr.py
Using PROJECT_ROOT (for PYTHONPATH): /coh_labs/dits/nsong/manuscript/DiSCoTME
=== CUDA check ===
CUDA_VISIBLE_DEVICES=0,1
Tesla V100-SXM2-16GB, 0
Tesla V100-SXM2-16GB, 1
==================
[INFO] Running: /home/nsong/anaconda3/envs/gigapath/bin/python visualization_usr.py --data-root /coh_labs/dits/nsong/manuscript/SPA1_D --metadata-csv metadata.csv --model-path /coh_labs/dits/nsong/manuscript/DiSCoTME/TME_aware_model/checkpoints/geneattn_ddp_20251207_150949/final_model.pth --output-dir /coh_labs/dits/nsong/manuscript/SPA1_D/results --output-suffix e5
Starting visualization at Sun Dec  7 15:28:46 MST 2025...
[INFO] PROJECT_ROOT added to sys.path: /coh_labs/dits/nsong/manuscript/DiSCoTME
Output directory: /coh_labs/dits/nsong/manuscript/SPA1_D/results
Dataset Initializing with num_local=15, num_global=0, local_distance=400
Time to load df_meta: 0.01s
Time to load df_spatial: 0.01s
Time to merge dataframes: 0.01s
Dataset contains 2028 valid spots after merge.
Time for df column processing and normalization: 0.01s
Building spot contexts using (V1 RegularVisium) build_spot_contexts_fast...
Context building (V1) complete. Each spot has 15 local and 0 global context spots. Time taken: 0.32s
Total Dataset Initialization time: 0.36s
Create LongNetEncoder: LongNet_for_spatial, # trainable params= 3.17M
Create LongNetEncoder: LongNet_for_spatial, # trainable params= 3.17M
Loading model from: /coh_labs/dits/nsong/manuscript/DiSCoTME/TME_aware_model/checkpoints/geneattn_ddp_20251207_150949/final_model.pth
Extracted embeddings shapes:
Image: (2028, 129), Gene: (2028, 129), Fused: (2028, 129)
Saved fused embeddings to: /coh_labs/dits/nsong/manuscript/SPA1_D/results/fused_embeddings_e5.csv
Saved image embeddings to: /coh_labs/dits/nsong/manuscript/SPA1_D/results/image_embeddings_e5.csv
Saved gene embeddings to: /coh_labs/dits/nsong/manuscript/SPA1_D/results/gene_embeddings_e5.csv

--- Processing clustering with k=4 ---
Created directory: /coh_labs/dits/nsong/manuscript/SPA1_D/results/k4
Saved fused clusters to: /coh_labs/dits/nsong/manuscript/SPA1_D/results/k4/fused_clusters_e5.csv
Saved image clusters to: /coh_labs/dits/nsong/manuscript/SPA1_D/results/k4/image_clusters_e5.csv
Saved gene clusters to: /coh_labs/dits/nsong/manuscript/SPA1_D/results/k4/gene_clusters_e5.csv

--- Processing clustering with k=5 ---
Created directory: /coh_labs/dits/nsong/manuscript/SPA1_D/results/k5
Saved fused clusters to: /coh_labs/dits/nsong/manuscript/SPA1_D/results/k5/fused_clusters_e5.csv
Saved image clusters to: /coh_labs/dits/nsong/manuscript/SPA1_D/results/k5/image_clusters_e5.csv
Saved gene clusters to: /coh_labs/dits/nsong/manuscript/SPA1_D/results/k5/gene_clusters_e5.csv

--- Processing clustering with k=6 ---
Created directory: /coh_labs/dits/nsong/manuscript/SPA1_D/results/k6
Saved fused clusters to: /coh_labs/dits/nsong/manuscript/SPA1_D/results/k6/fused_clusters_e5.csv
Saved image clusters to: /coh_labs/dits/nsong/manuscript/SPA1_D/results/k6/image_clusters_e5.csv
Saved gene clusters to: /coh_labs/dits/nsong/manuscript/SPA1_D/results/k6/gene_clusters_e5.csv

--- Processing clustering with k=7 ---
Created directory: /coh_labs/dits/nsong/manuscript/SPA1_D/results/k7
Saved fused clusters to: /coh_labs/dits/nsong/manuscript/SPA1_D/results/k7/fused_clusters_e5.csv
Saved image clusters to: /coh_labs/dits/nsong/manuscript/SPA1_D/results/k7/image_clusters_e5.csv
Saved gene clusters to: /coh_labs/dits/nsong/manuscript/SPA1_D/results/k7/gene_clusters_e5.csv

--- Processing clustering with k=8 ---
Created directory: /coh_labs/dits/nsong/manuscript/SPA1_D/results/k8
Saved fused clusters to: /coh_labs/dits/nsong/manuscript/SPA1_D/results/k8/fused_clusters_e5.csv
Saved image clusters to: /coh_labs/dits/nsong/manuscript/SPA1_D/results/k8/image_clusters_e5.csv
Saved gene clusters to: /coh_labs/dits/nsong/manuscript/SPA1_D/results/k8/gene_clusters_e5.csv

--- Processing clustering with k=9 ---
Created directory: /coh_labs/dits/nsong/manuscript/SPA1_D/results/k9
Saved fused clusters to: /coh_labs/dits/nsong/manuscript/SPA1_D/results/k9/fused_clusters_e5.csv
Saved image clusters to: /coh_labs/dits/nsong/manuscript/SPA1_D/results/k9/image_clusters_e5.csv
Saved gene clusters to: /coh_labs/dits/nsong/manuscript/SPA1_D/results/k9/gene_clusters_e5.csv

--- Processing clustering with k=10 ---
Created directory: /coh_labs/dits/nsong/manuscript/SPA1_D/results/k10
Saved fused clusters to: /coh_labs/dits/nsong/manuscript/SPA1_D/results/k10/fused_clusters_e5.csv
Saved image clusters to: /coh_labs/dits/nsong/manuscript/SPA1_D/results/k10/image_clusters_e5.csv
Saved gene clusters to: /coh_labs/dits/nsong/manuscript/SPA1_D/results/k10/gene_clusters_e5.csv

Visualization complete!
------------------------------------------------------------------------------------
Visualization finished at Sun Dec  7 15:32:25 MST 2025 with exit code 0
Job finished.
